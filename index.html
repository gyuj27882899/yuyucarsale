<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚®ç‚®ç‹ (è¯Šæ–­æ¨¡å¼)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #1a1a1a; color: #fff; }
        .profile-card { background-color: #2d2d2d; }
        .line-btn { background-color: #06C755; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

    <!-- ğŸš¨ è¯Šæ–­è®¯æ¯åŒº (Debug Area) ğŸš¨ -->
    <div id="debug-area" class="bg-red-900 text-white p-4 text-xs font-mono border-b-4 border-red-500 overflow-auto h-48">
        <h3 class="font-bold text-lg mb-2">ğŸš¨ ç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š (è¯·æˆªå›¾ç»™æˆ‘çœ‹)</h3>
        <p id="debug-msg">æ­£åœ¨è¿çº¿èµ„æ–™åº“...</p>
        <ul id="debug-list" class="list-disc pl-5 mt-2 space-y-1"></ul>
    </div>

    <!-- åˆ—è¡¨åŒº -->
    <section class="max-w-6xl mx-auto px-4 py-8 flex-grow">
        <div id="profiles-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- å†…å®¹ç”ŸæˆåŒº -->
        </div>
    </section>

    <!-- æ ¸å¿ƒé€»è¾‘ -->
    <script>
        // ==========================================
        // ğŸ‘‡ è¯·ç¡®è®¤è¿™é‡Œçš„ CSV è¿ç»“æ˜¯å¦æ­£ç¡® ğŸ‘‡
        // ==========================================
        const googleSheetCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnvM52ixrMGKzLTMMleErStxnyRpFlsPuMUlSc2HdNwIbJhgPrz_eDe7xMgbZv4acLBPK5u9JS6r20/pub?gid=0&single=true&output=csv"; 
        const myLineId = "ä½ çš„LINE_ID"; 
        // ==========================================

        const debugMsg = document.getElementById('debug-msg');
        const debugList = document.getElementById('debug-list');
        const container = document.getElementById('profiles-container');

        function log(msg, isError = false) {
            console.log(msg);
            const li = document.createElement('li');
            li.textContent = msg;
            if (isError) li.style.color = '#ff9999';
            debugList.appendChild(li);
        }

        // è¿ç»“è½¬æ¢å™¨
        function convertDriveLink(url) {
            if (!url) return null;
            if (url.includes('drive.google.com')) {
                const idMatch = url.match(/\/d\/(.*?)\/|\?id=(.*?)$/);
                const id = idMatch ? (idMatch[1] || idMatch[2]) : null;
                if (id) return `https://drive.google.com/uc?export=view&id=${id}`;
            }
            return url;
        }

        function init() {
            log(`å¼€å§‹è¯»å– CSV: ${googleSheetCsvUrl}`);
            
            if (!googleSheetCsvUrl) {
                log("âŒ é”™è¯¯: CSV è¿ç»“ä¸ºç©ºï¼è¯·æ£€æŸ¥ä»£ç ã€‚", true);
                return;
            }

            const cacheBuster = (googleSheetCsvUrl.includes('?') ? '&' : '?') + 't=' + new Date().getTime();
            
            Papa.parse(googleSheetCsvUrl + cacheBuster, {
                download: true,
                header: true,
                complete: function(results) {
                    log(`âœ… CSV è¯»å–æˆåŠŸï¼å…±æ‰¾åˆ° ${results.data.length} ç¬”èµ„æ–™`);
                    
                    if (results.data.length > 0) {
                        // æ£€æŸ¥æ ä½åç§°
                        const headers = Object.keys(results.data[0]);
                        log(`ğŸ“‹ ä¾¦æµ‹åˆ°çš„æ ä½åç§°: ${headers.join(", ")}`);
                        
                        // æ£€æŸ¥å…³é”®æ ä½æ˜¯å¦å­˜åœ¨
                        const hasName = headers.some(h => h.toLowerCase() === 'name');
                        const hasImage = headers.some(h => h.toLowerCase() === 'mainimage');
                        
                        if (!hasName) log("âš ï¸ è­¦å‘Š: æ‰¾ä¸åˆ° 'Name' æ ä½ (è¯·æ£€æŸ¥å¤§å°å†™)", true);
                        if (!hasImage) log("âš ï¸ è­¦å‘Š: æ‰¾ä¸åˆ° 'MainImage' æ ä½ (è¯·æ£€æŸ¥å¤§å°å†™)", true);
                    }

                    results.data.forEach((item, index) => {
                        const name = item.Name || item.name;
                        const rawImg = item.MainImage || item.mainImage;
                        const finalImg = convertDriveLink(rawImg);
                        
                        if (!name) {
                            log(`âš ï¸ ç¬¬ ${index + 1} è¡Œèµ„æ–™è¢«ç•¥è¿‡ (å› ä¸ºæ²¡æœ‰åå­—)`);
                            return;
                        }

                        log(`â¡ï¸ è¯»å–åˆ°: ${name} | å›¾ç‰‡åŸå§‹è¿ç»“: ${rawImg ? rawImg.substring(0, 30) + "..." : "æ— "} | è½¬æ¢å: ${finalImg ? finalImg.substring(0, 30) + "..." : "æ— "}`);

                        // ç®€å•çš„æ¸²æŸ“æµ‹è¯•
                        container.innerHTML += `
                            <div class="profile-card rounded-xl overflow-hidden shadow-lg p-4 border border-gray-700">
                                <h3 class="text-xl font-bold mb-2">${name}</h3>
                                <p class="text-xs text-gray-400 mb-2">åŸå§‹è¿ç»“: ${rawImg}</p>
                                <div class="h-48 bg-gray-800 flex items-center justify-center overflow-hidden rounded">
                                    <img src="${finalImg}" alt="${name}" class="w-full h-full object-cover" 
                                         onload="log('âœ… å›¾ç‰‡è½½å…¥æˆåŠŸ: ${name}')" 
                                         onerror="log('âŒ å›¾ç‰‡è½½å…¥å¤±è´¥: ${name} (å¯èƒ½æ˜¯æƒé™æ²¡å¼€)', true); this.src='https://via.placeholder.com/300?text=Error'">
                                </div>
                            </div>
                        `;
                    });
                    
                    debugMsg.textContent = "è¯Šæ–­å®Œæˆã€‚è¯·æŸ¥çœ‹ä¸‹æ–¹åˆ—è¡¨æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ã€‚";
                },
                error: function(err) {
                    log(`âŒ CSV è¯»å–å¤±è´¥: ${err.message}`, true);
                    debugMsg.textContent = "è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¿ç»“ã€‚";
                }
            });
        }

        init();
    </script>
</body>
</html>
