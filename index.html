<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¼˜ä¼˜è½¦è¡Œ</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆæç®€ï¼‰ -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="left">
        <a class="icon-btn" href="#" aria-label="Search">ğŸ”</a>
      </div>

      <div class="brand">
        <div class="brand-name">ä¼˜ä¼˜è½¦è¡Œ</div>
        <div class="brand-sub">è½¦è¾†å±•ç¤ºï½œä»·æ ¼é€æ˜ï½œLINE ä¸€é”®è”ç³»</div>
      </div>

      <div class="right">
        <a class="pill" href="#" onclick="scrollToSection('cars');return false;">è½¦è¾†</a>
        <a class="pill pill-primary" id="lineTop" target="_blank" rel="noopener">åŠ  LINE</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- åˆ†ç±»åŒºåŸŸï¼šä½ è¯´çš„ã€Œæ ‡é¢˜ + åº•ä¸‹éƒ½æ˜¯è¯•å›¾ã€ -->
    <section class="section" id="cars">
      <div class="section-head">
        <h2 class="section-title">ç²¾é€‰è½¦è¾†</h2>
        <div class="section-tools">
          <select id="sortSelect" class="select">
            <option value="latest">ä¾æœ€æ–°é¡¹ç›®æ’åº</option>
            <option value="priceAsc">ä»·æ ¼ï¼šä½ â†’ é«˜</option>
            <option value="priceDesc">ä»·æ ¼ï¼šé«˜ â†’ ä½</option>
          </select>
        </div>
      </div>

      <div id="grid" class="grid"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">Â© ä¼˜ä¼˜è½¦è¡Œ</div>
  </footer>

  <script src="./cars.js"></script>
  <script>
    const grid = document.getElementById("grid");
    const LINE_URL = window.LINE_URL || "https://line.me/R/ti/p/oocheckoo";

    // é¡¶éƒ¨ã€ŒåŠ  LINEã€
    document.getElementById("lineTop").href = LINE_URL;

    function formatPrice(n, currency="LKR") {
      return new Intl.NumberFormat("en-US").format(n) + " " + currency;
    }

    function lineLink(car){
      const msg = encodeURIComponent(
        `æˆ‘æƒ³è¯¢é—®è¿™å°è½¦ï¼š${car.title}\nä»·æ ¼ï¼š${formatPrice(car.price, car.currency)}\nç¼–å·ï¼š${car.id}`
      );
      return `${LINE_URL}?text=${msg}`;
    }

    function scrollToSection(id){
      const el = document.getElementById(id);
      if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
    }

    function render(list){
      grid.innerHTML = "";
      (list || []).forEach(car => {
        const tags = (car.tags || []).map(t => `<span class="tag">${t}</span>`).join("");
        const spec = (car.spec || []).map(s => `<li>${s}</li>`).join("");

        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="media">
            <img src="${car.image}" alt="${car.title}" loading="lazy" />
          </div>

          <div class="card-body">
            <div class="card-title-row">
              <h3 class="card-title">${car.title}</h3>
              <div class="card-id">${car.id}</div>
            </div>

            <div class="card-price">${formatPrice(car.price, car.currency)}</div>

            <div class="meta">
              ${car.year ? `<span class="tag">${car.year}</span>` : ""}
              ${car.location ? `<span class="tag">${car.location}</span>` : ""}
              ${car.mileage ? `<span class="tag">${car.mileage}</span>` : ""}
              ${tags}
            </div>

            <ul class="spec">
              ${spec}
            </ul>

            <div class="actions">
              <a class="btn" href="${lineLink(car)}" target="_blank" rel="noopener">ç”¨ LINE è¯¢é—®</a>
              <a class="btn btn-ghost" href="${LINE_URL}" target="_blank" rel="noopener">åŠ  LINE</a>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // æ’åº
    const cars = (window.CARS || []).slice();
    const sortSelect = document.getElementById("sortSelect");

    function applySort(){
      const v = sortSelect.value;
      const list = cars.slice();
      if(v === "priceAsc") list.sort((a,b)=>(a.price||0)-(b.price||0));
      if(v === "priceDesc") list.sort((a,b)=>(b.price||0)-(a.price||0));
      // latestï¼šç»´æŒåŸé¡ºåº
      render(list);
    }

    sortSelect.addEventListener("change", applySort);
    applySort();
  </script>
</body>
</html>
