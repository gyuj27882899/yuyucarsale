<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- ğŸŸ¢ é—œéµè¨­å®šï¼šå¼·åˆ¶é—œé–‰ Referrerï¼Œç¢ºä¿ Google Drive åœ–ç‰‡åœ¨æ‰‹æ©Ÿå¯è®€å– -->
    <meta name="referrer" content="no-referrer">
    
    <title>ç‚®ç‚®ç‹ | å°æ±å¤–ç´„é¦–é¸</title>
    <meta name="description" content="å°æ±æœ€å„ªè³ªçš„å¤–ç´„èˆ‡å°ˆå±¬é™ªä¼´æœå‹™ã€‚ç…§ç‰‡çœŸå¯¦ï¼Œåƒ¹æ ¼é€æ˜ã€‚">

    <!-- å¤–éƒ¨è³‡æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        /* åŸºç¤æ¨£å¼ */
        body { background-color: #121212; color: white; font-family: sans-serif; margin: 0; -webkit-tap-highlight-color: transparent; }
        
        /* å¡ç‰‡è¨­è¨ˆ */
        .card { 
            background: #1e1e1e; 
            margin-bottom: 0; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 1px solid #333;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); }
        
        /* åœ–ç‰‡å®¹å™¨ï¼šå›ºå®šæ¯”ä¾‹é¿å…è·‘ç‰ˆ */
        .img-box {
            width: 100%;
            height: 0;
            padding-bottom: 125%; /* 4:5 æ¯”ä¾‹ï¼Œé©åˆäººåƒ */
            position: relative;
            background-color: #000;
        }
        .img-box img { 
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; 
            object-fit: cover; 
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-main {
            background: linear-gradient(to right, #06C755, #05b34c);
            color: white;
            font-weight: bold;
            padding: 12px;
            border-radius: 50px;
            text-align: center;
            display: block;
            width: 100%;
            box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3);
        }

        /* å½ˆçª—æ¨£å¼ */
        #popup {
            position: fixed; inset: 0; z-index: 50;
            background-color: rgba(0, 0, 0, 0.95);
            display: none; /* é è¨­éš±è— */
            flex-direction: column;
            align-items: center; justify-content: center;
        }
        
        /* å½ˆçª—å…§å®¹å€ */
        .popup-scroll {
            width: 100%;
            height: 75vh;
            display: flex;
            align-items: center;
            overflow-x: auto; 
            scroll-snap-type: x mandatory;
            gap: 10px;
            padding: 0 10px;
        }
        
        .popup-item {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: center;
            position: relative;
        }
        
        .popup-item img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <!-- å°èˆª -->
    <nav class="bg-gray-900 p-4 sticky top-0 z-40 flex justify-between items-center shadow-lg border-b border-gray-800">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-crown text-yellow-500 text-xl"></i>
            <span class="text-xl font-bold tracking-wider">ç‚®ç‚®ç‹</span>
        </div>
        <a href="#" id="navLineBtn" target="_blank" class="bg-white text-green-700 px-4 py-1.5 rounded-full text-sm font-bold shadow-md">
            <i class="fa-brands fa-line mr-1"></i> å®¢æœ
        </a>
    </nav>

    <!-- å…§å®¹å€ -->
    <div class="max-w-4xl mx-auto p-4 pb-20">
        
        <!-- æœå°‹ -->
        <div class="mb-6">
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-gray-400"></i>
                <input type="text" id="searchInput" placeholder="æœå°‹è»Šåã€é—œéµå­—..." 
                       class="w-full pl-12 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-full text-white focus:outline-none focus:border-yellow-500">
            </div>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div id="status-msg" class="text-center py-20 text-gray-400">
            <i class="fa-solid fa-circle-notch fa-spin text-3xl mb-3 text-yellow-500"></i><br>
            è³‡æ–™åº«é€£ç·šä¸­...
        </div>

        <!-- åˆ—è¡¨ -->
        <div id="list-area" class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden"></div>
        <div id="no-result" class="hidden text-center py-20 text-gray-500">æŸ¥ç„¡ç›¸é—œè³‡æ–™</div>
    </div>

    <!-- é è…³ -->
    <footer class="text-center py-6 text-gray-600 text-xs border-t border-gray-800">
        &copy; 2025 ç‚®ç‚®ç‹. All Rights Reserved.
    </footer>

    <!-- å½ˆçª— (å…¨è¢å¹•) -->
    <div id="popup">
        <button onclick="closePopup()" class="absolute top-6 left-6 text-white text-lg bg-gray-800/80 px-4 py-2 rounded-full z-50 backdrop-blur-sm border border-gray-600">
            <i class="fa-solid fa-arrow-left mr-2"></i> è¿”å›
        </button>
        
        <h2 id="popup-title" class="absolute top-6 w-full text-center font-bold text-xl pointer-events-none mt-2 drop-shadow-md"></h2>

        <div id="popup-content" class="popup-scroll">
            <!-- åœ–ç‰‡æœƒå¡åœ¨é€™è£¡ -->
        </div>

        <div class="absolute bottom-10 w-full px-6 max-w-md">
            <p class="text-center text-xs text-gray-400 mb-3 animate-pulse">å·¦å³æ»‘å‹•æŸ¥çœ‹æ›´å¤š | é»æ“Šæ’­æ”¾å½±ç‰‡</p>
            <a href="#" id="popup-line-btn" class="btn-main">
                ç«‹å³ LINE é ç´„
            </a>
        </div>
    </div>

    <script>
        // ğŸ‘‡ è¨­å®šå€ ğŸ‘‡
        const myLineId = "ä½ çš„LINE_ID"; 
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnvM52ixrMGKzLTMMleErStxnyRpFlsPuMUlSc2HdNwIbJhgPrz_eDe7xMgbZv4acLBPK5u9JS6r20/pub?gid=1682452717&single=true&output=csv";
        // -----------------------

        const statusMsg = document.getElementById('status-msg');
        const listArea = document.getElementById('list-area');
        const noResult = document.getElementById('no-result');
        const popup = document.getElementById('popup');
        let allData = [];
        let currentData = [];

        document.getElementById('navLineBtn').href = `https://line.me/ti/p/~${myLineId}`;

        // 1. å•Ÿå‹•
        init();

        function init() {
            // å¼·åˆ¶åŠ ä¸Šæ™‚é–“æˆ³è¨˜ï¼Œé¿å…æ‰‹æ©Ÿå¿«å–èˆŠçš„å£è³‡æ–™
            const url = csvUrl + "&t=" + new Date().getTime();
            
            Papa.parse(url, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (!results.data || results.data.length === 0) {
                        statusMsg.innerHTML = "âš ï¸ é€£ç·šæˆåŠŸï¼Œä½† Excel æ˜¯ç©ºçš„";
                        return;
                    }

                    // éæ¿¾è³‡æ–™ (åªè¦æœ‰åå­—å°±ç®—æœ‰æ•ˆ)
                    allData = results.data.filter(item => {
                        return getValue(item, ['è»Šå', 'åå­—', 'å§“å', 'Name']);
                    });

                    if (allData.length > 0) {
                        statusMsg.classList.add('hidden');
                        listArea.classList.remove('hidden');
                        currentData = allData;
                        render(allData);
                    } else {
                        statusMsg.innerHTML = "âš ï¸ æ‰¾ä¸åˆ°ã€Œè»Šåã€æ¬„ä½ï¼Œè«‹æª¢æŸ¥ Excel æ¨™é¡Œã€‚";
                    }
                },
                error: function(err) {
                    statusMsg.innerHTML = "âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚";
                }
            });
        }

        // è¼”åŠ©ï¼šè®€å–æ¬„ä½ (è‡ªå‹•å¿½ç•¥å¤§å°å¯«ã€ç©ºæ ¼)
        function getValue(item, keys) {
            // æ­£è¦åŒ– item keys
            const normalizedItem = {};
            Object.keys(item).forEach(k => normalizedItem[k.trim().toLowerCase()] = item[k]);
            
            for (let target of keys) {
                const val = normalizedItem[target.toLowerCase()];
                if (val) return val.trim();
            }
            return "";
        }

        // è¼”åŠ©ï¼šè½‰æ›åœ–ç‰‡é€£çµ (å¼·åˆ¶ç”¨ç¸®åœ– API)
        function getImgUrl(url) {
            if (!url) return "https://via.placeholder.com/600x800?text=No+Image";
            // ç§»é™¤å¯èƒ½å­˜åœ¨çš„ #video æ¨™è¨˜
            const cleanUrl = url.split('#')[0];
            const match = cleanUrl.match(/[-\w]{25,}/);
            const id = match ? match[0] : null;
            if (id) return `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
            return url;
        }

        // 2. æ¸²æŸ“ç•«é¢
        function render(data) {
            listArea.innerHTML = "";
            
            if (data.length === 0) {
                noResult.classList.remove('hidden');
                return;
            } else {
                noResult.classList.add('hidden');
            }

            data.forEach((item, idx) => {
                const name = getValue(item, ['è»Šå', 'åå­—']);
                const price = getValue(item, ['è»Šåƒ¹', 'åƒ¹æ ¼']);
                const age = getValue(item, ['è»Šé½¡', 'å¹´é½¡']) || "--";
                const body = getValue(item, ['è»Šèº«', 'èº«æ']) || "--";
                const origin = getValue(item, ['è»Šç±', 'åœ°é»']) || "å°æ±";
                
                // åœ–ç‰‡è™•ç† (å–ç¬¬ä¸€å¼µç•¶å°é¢)
                const rawImg = getValue(item, ['ç…§ç‰‡', 'åœ–ç‰‡', 'Image', 'MainImage']);
                const firstImg = rawImg.split(',')[0];
                const imgUrl = getImgUrl(firstImg);

                // ç‹€æ…‹
                const status = getValue(item, ['ç‹€æ…‹', 'Status', 'ç›®å‰ç‹€æ…‹']);
                const isBusy = ["å¿™", "busy", "no", "x", "é ç´„"].some(k => status.toLowerCase().includes(k));
                
                const badge = isBusy 
                    ? `<span class="absolute top-3 left-3 bg-red-600 text-white text-xs px-3 py-1 rounded-full font-bold z-10 shadow-md">å¿™ç¢Œä¸­</span>`
                    : `<span class="absolute top-3 left-3 bg-green-500 text-white text-xs px-3 py-1 rounded-full font-bold z-10 shadow-md">å¯é ç´„</span>`;

                const html = `
                    <div class="card relative group" onclick="openPopup(${idx})">
                        <div class="img-box">
                            ${badge}
                            <img src="${imgUrl}" loading="lazy">
                            <div class="absolute bottom-0 w-full bg-gradient-to-t from-black to-transparent p-4 pt-12">
                                <h3 class="text-2xl font-bold text-white drop-shadow-md">${name}</h3>
                            </div>
                        </div>
                        <div class="p-4 bg-[#252525]">
                            <div class="grid grid-cols-2 gap-2 mb-3 text-sm text-gray-300">
                                <div class="bg-gray-800 p-1.5 rounded text-center">è»Šé½¡: ${age}</div>
                                <div class="bg-gray-800 p-1.5 rounded text-center">è»Šç±: ${origin}</div>
                                <div class="bg-gray-800 p-1.5 rounded text-center col-span-2">è»Šèº«: ${body}</div>
                            </div>
                            <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-700">
                                <span class="text-yellow-400 font-bold text-lg">$${price}</span>
                                <span class="text-green-500 text-sm font-bold flex items-center">
                                    é ç´„ <i class="fa-solid fa-chevron-right ml-1"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                listArea.innerHTML += html;
            });
        }

        // 3. å½ˆçª—é‚è¼¯
        window.openPopup = function(idx) {
            const item = currentData[idx]; // ä½¿ç”¨ç•¶å‰æœå°‹çµæœçš„è³‡æ–™
            if (!item) return;

            const name = getValue(item, ['è»Šå', 'åå­—']);
            document.getElementById('popup-title').innerText = name;
            
            const content = document.getElementById('popup-content');
            content.innerHTML = "";

            // è™•ç†åœ–ç‰‡èˆ‡å½±ç‰‡
            const rawImg = getValue(item, ['ç…§ç‰‡', 'åœ–ç‰‡', 'Image']);
            if (rawImg) {
                // æ”¯æ´ç”¨é€—è™Ÿã€ç©ºç™½ã€æ›è¡Œåˆ†éš”
                rawImg.split(/[,ï¼Œ\s]+/).forEach(url => {
                    if (url.trim() == "" || url.length < 5) return;
                    
                    const div = document.createElement('div');
                    div.className = "popup-item";
                    
                    // åµæ¸¬å½±ç‰‡ (#video æˆ– .mp4)
                    if (url.includes("#video") || url.includes(".mp4")) {
                        // å½±ç‰‡ï¼šç”¨å‡å°é¢ -> é»æ“Šå»å¤–éƒ¨æ’­æ”¾ (æœ€ç©©)
                        const match = url.match(/[-\w]{25,}/);
                        const id = match ? match[0] : "";
                        if(id) {
                            const thumb = `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
                            const videoLink = `https://drive.google.com/file/d/${id}/preview`; 
                            
                            div.innerHTML = `
                                <a href="${videoLink}" target="_blank" class="relative w-full h-full flex justify-center items-center">
                                    <img src="${thumb}" style="opacity:0.6;">
                                    <i class="fa-solid fa-play-circle text-7xl text-white absolute drop-shadow-lg opacity-90"></i>
                                    <p class="absolute bottom-20 text-white text-sm bg-black/50 px-3 py-1 rounded-full">é»æ“Šæ’­æ”¾å½±ç‰‡</p>
                                </a>
                            `;
                        }
                    } else {
                        // åœ–ç‰‡
                        const src = getImgUrl(url);
                        div.innerHTML = `<img src="${src}">`;
                    }
                    content.appendChild(div);
                });
            }

            // LINE æŒ‰éˆ•
            const price = getValue(item, ['è»Šåƒ¹', 'åƒ¹æ ¼']);
            const msg = encodeURIComponent(`ä½ å¥½ï¼Œæˆ‘æ­£åœ¨çœ‹ã€Œ${name}ã€çš„ç…§ç‰‡ï¼Œæƒ³é å®šæ–¹æ¡ˆ $${price}/40åˆ†é˜`);
            document.getElementById('popup-line-btn').href = `https://line.me/ti/p/~${myLineId}?text=${msg}`;

            document.getElementById('popup').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        window.closePopup = function() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('popup-content').innerHTML = "";
            document.body.style.overflow = 'auto';
        }

        // æœå°‹åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase().trim();
            currentData = allData.filter(item => {
                // å°‡æ‰€æœ‰æ¬„ä½å€¼ä¸²èµ·ä¾†æœå°‹
                return Object.values(item).join(" ").toLowerCase().includes(term);
            });
            render(currentData);
        });

    </script>
</body>
</html>
